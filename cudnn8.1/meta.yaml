{% set version = "8.1.1.33" %}
{% set cuda_version = cudatoolkit | replace('.*',"") %}

{% set arch = "ppc64le" %}  # [ppc64le]
{% set arch = "x64" %}  # [x86_64]
  
package:
  name: cudnn
  version: {{ version.rsplit('.', 1)[0] + "_" + cuda_version }}

build:
  number: 1
  missing_dso_whitelist:
          - "*/libstdc++.so.6"      
          - "*/libm.so.6"      
          - "*/librt.so.1"      
          - "*/libpthread.so.0"      
          - "*/libdl.so.2"      
          - "*/libgcc_s.so.1"      
          - "*/libc.so.6"      
          - "*/ld*64.so.2"    

requirements:
  run:
    - cudatoolkit {{ cudatoolkit }}

source:
  url: https://developer.download.nvidia.com/compute/redist/cudnn/v{{ ".".join(version.split(".")[:3]) }}/cudnn-{{ cuda_version }}-linux-{{ arch }}-v{{ version }}.tgz
  sha256: 98a8784e92862f20018d20c281b30d4a0cd951f93694f6433ccf4ae9c502ba6a  # [x86_64]
  sha256: c3e535a5d633ad8f4d50be0b6f8efd084c6c6ed3525c07cbd89fc508b1d76c7a  # [ppc64le]
  folder: cudnn

test:
  commands:
    - test -f ${PREFIX}/lib/libcudnn.so
    - test -f ${PREFIX}/lib/libcudnn_static.a

about: 
    license_file: LICENSE
    summary: The NVIDIA CUDA Deep Neural Network library. A GPU-accelerated library of primitives for deep neural networks.

extra:
  recipe-maintainers:
    - open-ce/open-ce-dev-team
